<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fake Favorite</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="4fav.css?v=1.2">
<style>
#posterToggle:checked + span {
  background-color: hsl(25,95%,55%);
}
#posterToggle:checked + span + #toggleThumb {
  transform: translateX(100%);
}
#toggleThumb {
  transition: transform 0.3s ease;
}
</style>
</head>
<body class="flex flex-col min-h-screen">

<header class="bg-film-surface/80 backdrop-blur-md border-b border-gray-800 sticky top-0 z-50">
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <a href="/letterboxd-game/" class="flex items-center gap-2">
      <div class="w-9 h-9 rounded-lg bg-orange-500 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 text-white">
          <path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/>
        </svg>
      </div>
      <span class="text-xl font-serif font-bold">
        Letterboxd <span class="text-gradient-accent">Games</span>
      </span>
    </a>
    <nav class="flex items-center gap-6">
      <a href="/letterboxd-game/" class="hover:text-white transition">Home</a>
      <a href="/letterboxd-game/info" class="hover:text-white transition">Info</a>
    </nav>
  </div>
</header>

<section class="relative text-center py-20 bg-gradient-to-br from-gray-900 via-gray-800 to-green-900">
  <div class="max-w-3xl mx-auto px-4">
    <h1 class="text-4xl md:text-5xl font-bold mb-4">
      Find the <span class="text-gradient-accent">Fake Favorite</span>
    </h1>
    <p class="text-gray-400 text-lg">
      One of these movies is NOT in this user's favorites. Tap the fake one.
    </p>
  </div>
</section>

<div class="bg-film-surface/90 backdrop-blur-md border-b border-gray-800 py-3 px-6 flex justify-end items-center">
  <span class="text-white mr-3">Allow Custom Posters:</span>
  <label class="relative inline-block w-12 h-6 cursor-pointer">
    <input type="checkbox" id="posterToggle" class="sr-only" checked>
    <span class="block bg-gray-700 rounded-full w-full h-full transition"></span>
    <span class="absolute left-0.5 top-0.5 w-5 h-5 bg-orange-600 rounded-full transition transform" id="toggleThumb"></span>
  </label>
</div>

<section class="container mx-auto px-4 py-12 flex-1">
  <div id="username" class="text-2xl md:text-3xl font-serif font-bold text-gradient-accent mb-10 text-center"></div>
  <div id="moviesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-6 md:gap-10 max-w-6xl mx-auto mb-14"></div>
  <div class="text-center">
    <div id="result" class="text-xl md:text-2xl font-bold min-h-[48px] mb-6"></div>
    <button id="playAgainBtn" class="bg-orange-500 hover:bg-orange-600 text-black px-6 py-3 font-semibold rounded-lg transition">
      Play Again
    </button>
  </div>
</section>

<footer class="bg-film-surface border-t border-gray-800 py-12 text-center mt-auto">
  <h3 class="text-orange-500 mb-2">
    Letterboxd Games ~ Fan project, Not affiliated with Letterboxd
  </h3>
  <p class="text-gray-400 mb-1 flex items-center justify-center gap-2">
    Made with
    <svg width="18" height="18" viewBox="0 0 24 24" class="inline-block">
      <defs>
        <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="hsl(25,95%,55%)"/>
          <stop offset="100%" stop-color="hsl(35,90%,60%)"/>
        </linearGradient>
      </defs>
      <path
        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
           2 6 4 4 6.5 4 
           8.24 4 9.91 5.01 10.44 6.36 
           10.97 5.01 12.64 4 14.38 4 
           16.88 4 18.88 6 18.88 8.5 
           18.88 12.28 15.48 15.36 10.33 20.04L12 21.35z"
        fill="url(#heartGradient)"
      />
    </svg>
    for film lovers
  </p>
  <p class="text-gray-400">
    Follow me on 
    <a href="https://letterboxd.com/MovieLover384/" target="_blank" class="text-orange-500 hover:text-orange-400 underline">
      Letterboxd
    </a>
  </p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
let useCustomPosters = true;
let users = [];
let currentUser;
let fakeMovie;
let gameOver = false;
let currentMovies = [];

document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById("posterToggle");
  
  toggle.addEventListener("change", async () => {
    useCustomPosters = toggle.checked;
    const file = useCustomPosters ? "4fav.json" : "4fav_tmdb.json";
    const res = await fetch(file);
    const newUsers = await res.json();
    const updatedUser = newUsers.find(u => u.username === currentUser.username);
    if (updatedUser) {
      currentMovies = currentMovies.map(movie => {
        if (movie === fakeMovie) return movie;
        const match = updatedUser.favorites.find(fav => fav.title === movie.title);
        return match ? { ...movie, poster_url: match.poster_url } : movie;
      });
    }
    displayMovies(currentMovies);
  });

  loadUsers();
});

async function loadUsers() {
  const file = useCustomPosters ? "4fav.json" : "4fav_tmdb.json";
  const res = await fetch(file);
  users = await res.json();
  startGame();
}

function getRandomUser(excludeUser = null) {
  let user;
  do {
    user = users[Math.floor(Math.random() * users.length)];
  } while (user === excludeUser && users.length > 1);
  return user;
}

function startGame() {
  gameOver = false;
  document.getElementById("result").innerHTML = "";

  currentUser = getRandomUser();
  document.getElementById("username").innerHTML = `User: ${currentUser.username}`;

  const otherUser = getRandomUser(currentUser);
  fakeMovie = otherUser.favorites[Math.floor(Math.random() * otherUser.favorites.length)];

  currentMovies = [...currentUser.favorites, fakeMovie];
  currentMovies.sort(() => Math.random() - 0.5);

  displayMovies(currentMovies);
}

function displayMovies(movies) {
  const grid = document.getElementById("moviesGrid");
  grid.innerHTML = "";

  movies.forEach((movie, index) => {
    const card = document.createElement("div");
    card.className = "card-wrapper text-center cursor-pointer flex flex-col items-center";

    card.innerHTML = `
      <div class="flex flex-col items-center h-full">
        <div class="movie-title text-sm sm:text-base md:text-lg font-semibold text-white text-center px-2 mb-2 line-clamp-2 overflow-hidden min-h-[3rem]">
          ${movie.title}
        </div>
        <div class="card w-full flex-shrink-0">
          <img src="${movie.poster_url}" class="rounded-lg shadow-lg w-full object-cover h-48 md:h-56 lg:h-64">
        </div>
        <div class="movie-label text-lg font-bold mt-2 min-h-[24px] text-white"></div>
      </div>
    `;

    card.addEventListener("click", () => handleGuess(index));
    grid.appendChild(card);
  });
}

function handleGuess(selectedIndex) {
  if (gameOver) return;

  gameOver = true;
  const selectedMovie = currentMovies[selectedIndex];

  if (selectedMovie === fakeMovie) {
    document.getElementById("result").innerHTML = "You won! You found the fake!";
    document.getElementById("result").className = "text-white text-xl md:text-2xl font-bold min-h-[48px] mb-6";
    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
  } else {
    document.getElementById("result").innerHTML = "You lost! That one is real.";
    document.getElementById("result").className = "text-white text-xl md:text-2xl font-bold min-h-[48px] mb-6";
  }

  const allCards = document.querySelectorAll(".card-wrapper");
  allCards.forEach((card, index) => {
    const labelDiv = card.querySelector(".movie-label");
    const movie = currentMovies[index];

    labelDiv.textContent = movie === fakeMovie ? "FAKE ❌" : "REAL ✅";
    labelDiv.className = "movie-label text-lg font-bold mb-2 text-white";
  });
}

document.getElementById("playAgainBtn").addEventListener("click", loadUsers);
</script>

</body>
</html>